<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Chapter 12: NgRx and Lazy Loading | NgRx Essentials</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://this-is-angular.github.io/ngrx-essentials-course/docs/chapter-12"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Chapter 12: NgRx and Lazy Loading | NgRx Essentials"><meta data-react-helmet="true" name="description" content="Feature states"><meta data-react-helmet="true" property="og:description" content="Feature states"><link data-react-helmet="true" rel="shortcut icon" href="/ngrx-essentials-course/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://this-is-angular.github.io/ngrx-essentials-course/docs/chapter-12"><link data-react-helmet="true" rel="alternate" href="https://this-is-angular.github.io/ngrx-essentials-course/docs/chapter-12" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://this-is-angular.github.io/ngrx-essentials-course/docs/chapter-12" hreflang="x-default"><link rel="stylesheet" href="/ngrx-essentials-course/assets/css/styles.a07871b4.css">
<link rel="preload" href="/ngrx-essentials-course/assets/js/runtime~main.1ab2ca4b.js" as="script">
<link rel="preload" href="/ngrx-essentials-course/assets/js/main.7eecb326.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ngrx-essentials-course/"><img src="/ngrx-essentials-course/img/logo.svg" alt="NgRx Essentials" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/ngrx-essentials-course/img/logo.svg" alt="NgRx Essentials" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">NgRx Essentials</b></a><a class="navbar__item navbar__link navbar__link--active" href="/ngrx-essentials-course/docs/chapter-1">Course</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/this-is-angular/ngrx-essentials-course" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-1">Chapter 1: Introduction to NgRx</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-2">Chapter 2: Getting started: Installing dependencies and creating the project</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-3">Chapter 3: NgRx: The What</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-4">Chapter 4: NgRx: The Why</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-5">Chapter 5: Actions</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-6">Chapter 6: Reducers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-7">Chapter 7: Basic Selectors</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-8">Chapter 8: Modifying State</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-9">Chapter 9: Building a real application</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-10">Chapter 10: Working with side effects</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ngrx-essentials-course/docs/chapter-11">Chapter 11: Effects in depth</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/ngrx-essentials-course/docs/chapter-12">Chapter 12: NgRx and Lazy Loading</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Chapter 12: NgRx and Lazy Loading</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="feature-states"></a>Feature states<a class="hash-link" href="#feature-states" title="Direct link to heading">#</a></h2><p><a href="https://angular.io/guide/lazy-loading-ngmodules" target="_blank" rel="noopener noreferrer">Lazy loading</a> is an important Angular feature that boosts performance and allows for better, modular architecture. Basically, we split our app into feature modules, each corresponding to some app-specific feature, and then load those modules when needed (when the user navigates to them). Lazy loading is a built-in feature in Angular.</p><p>So how does NgRx relate to this? Let&#x27;s examine the structure of our app to understand better.</p><p>In our financial logger app we have at least two features: categories and logs. We might want to have pages that show all the logs, add new logs, add categories, and so on, so it makes sense to keep them separated.</p><p>But we have mentioned that the <code>State</code> in our <code>Store</code> is basically a large global object with no write access, meaning that we probably would want to define all the feature state slices beforehand; but that would kind of break the lazy loading logic: if the user never visits the category module pages, why would we even have any state related to categories stored?</p><p>Thankfully, NgRx got us covered.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="ngrx-feature-states"></a>NgRx Feature states<a class="hash-link" href="#ngrx-feature-states" title="Direct link to heading">#</a></h2><p>In NgRx, data from the lazy loaded modules can be stored in what is called Feature states; basically, our <code>Store</code> now will contain data like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(250, 208, 0)">AppState</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  categories</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">CategoryState</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  logs</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">LogState</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The trick here being that, say, <code>logs</code> is undefined from the start of the application until the user visits a page from the <code>LogsModule</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="preparing-for-feature-states"></a>Preparing for feature states<a class="hash-link" href="#preparing-for-feature-states" title="Direct link to heading">#</a></h2><p>Let us first create our first lazy loaded module: <code>LogsModule</code> and include it in our routing. Now, because <code>LogsModule</code> is a separate entity, it is going to have a separate <code>State</code>. Inside <code>LogsModule</code>, create a folder named <code>state</code>, with the same files we have in the root directory <code>state</code> folder. Then, let&#x27;s design our feature state:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// src/app/logs/state/state.ts</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">enum</span><span class="token plain"> </span><span class="token maybe-class-name">LogType</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token maybe-class-name">Spend</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;Spend&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token maybe-class-name">Income</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;Income&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(250, 208, 0)">Log</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  title</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">string</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  date</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">string</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  amount</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">number</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token keyword" style="color:rgb(255, 157, 0)">type</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">LogType</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  categoryId</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">number</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(250, 208, 0)">LogsState</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  logs</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Log</span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  loading</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    list</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">boolean</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    add</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">boolean</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> initialState</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">LogsState</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  logs</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  loading</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    list</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 98, 140)">false</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    add</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 98, 140)">false</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>So this is how our feature state will look like. It does not reference anything from the <code>AppState</code>, which is good, as our module is independent and lazy loaded. So how do we connect this independent state with the global, <code>AppState</code>? First, we will have to write a reducer. In the <code>database.json</code> file we also have a nested object called <code>logs</code>, which is an empty array. For the purpose of providing the opportunity to grow experience, we will skip writing the reducer and allow the reader to do that themselves.</p><p>Write a <code>logsReducer</code> and <code>LogsEffects</code> and come back to this chapter.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="lazy-loading-feature-states"></a>Lazy loading feature states<a class="hash-link" href="#lazy-loading-feature-states" title="Direct link to heading">#</a></h2><p>Now our states are inside a lazy loaded modules. How do we plug them into the existing <code>Store</code>? Turns out, this is pretty easy. In the <code>logs.module.ts</code>, add these lines:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// src/app/logs/logs.module.ts</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// import statements omitted</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(250, 208, 0)">NgModule</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// other metadata</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  imports</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// other imports</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token maybe-class-name">StoreModule</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token method function property-access" style="color:rgb(250, 208, 0)">forFeature</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">&quot;logsFeature&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> logsReducer</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token maybe-class-name">EffectsModule</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token method function property-access" style="color:rgb(250, 208, 0)">forFeature</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token maybe-class-name">LogsEffects</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(250, 208, 0)">LogsModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you have noticed, instead of <code>forRoot</code> we used methods called <code>forFeature</code>, which indicate these are reducers and effects tht are being added dynamically, after the user visits this particular module. The <code>StoreModule.forFeature</code> method&#x27;s first argument is the name of the feature state, which is being used when writing feature specific selectors. Let&#x27;s now write a selector that gets the list of logs (the empty array from the beginning of the chapter).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// src/app/logs/state/selectors.ts</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(250, 208, 0)">logs</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">state</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">AppState</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access">logsFeature</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access">logs</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The name <code>logsFeature</code> comes from the <code>StoreModule.forFeature</code> method&#x27;s first argument. NgRx provides an easy way to make less boilerplate and not have to use that name each time, by using a special <code>createFeatureSelector</code> function. Let&#x27;s rewrite our selector and see it in action:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// src/app/logs/state/selectors.ts</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> logsFeature </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">createFeatureSelector</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">&quot;logsFeature&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> logs </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">createSelector</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">logsFeature</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access">logs</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// state here is already the logsFeature `State`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>I personally use a small trick to write even less code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><pre tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#9EFEFF"><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">// src/app/logs/state/selectors.ts</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> logsFeature </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">createFeatureSelector</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">&quot;logsFeature&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> selector </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">&lt;</span><span class="token constant" style="color:rgb(250, 208, 0)">T</span><span class="token operator" style="color:rgb(255, 157, 0)">&gt;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token function-variable function" style="color:rgb(250, 208, 0)">mapping</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">state</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token maybe-class-name">LogsState</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(250, 208, 0)">T</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token function" style="color:rgb(250, 208, 0)">createSelector</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">logsFeature</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> mapping</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> logs </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">selector</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access">logs</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now our own <code>selector</code> function is a small wrapper (or a type of functions known as &quot;partial application&quot;) around <code>createSelector</code>, which always provides the first argument, so we don&#x27;t have to type it every time.</p><p>Now we already have a functioning lazy loaded feature state.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="where-to-be-careful"></a>Where to be careful<a class="hash-link" href="#where-to-be-careful" title="Direct link to heading">#</a></h2><p>Notice that our <code>AppState</code> is and remains a single, unique object. It is just that before the lazy loaded routes are visited, the corresponding nested feature states are <code>undefined</code>. So this may create some problems in the future if we are not careful. Imagine a scenario when we have new module, that now needs the <code>logs</code> data. Because <code>logs</code> is a lazy loaded feature, that data may or may not be available depending on whether the user had previously visited the <code>logs</code> routed pages. So if we need some data somewhere, we have to make sure that data is available higher up, and not in another lazy loaded module. As an exercise, try to determine if we need to make the <code>categories</code> a separately loaded feature module like <code>logs</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="homework"></a>Homework<a class="hash-link" href="#homework" title="Direct link to heading">#</a></h2><p>Homework for this chapter is quite extensive and non-specific: implement the whole lifecycle for financial logs: creating new logs, deleting them, and so on. Future chapters will assume those are implemented, and this will also be an important exercise for our newly acquired skills. If you want any sort of hints and guidance, feel free to take a look at the example app, where all the features are implemented.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/this-is-angular/ngrx-essentials-course/edit/main/docs/chapter-12.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ngrx-essentials-course/docs/chapter-11"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Chapter 11: Effects in depth</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#feature-states" class="table-of-contents__link">Feature states</a></li><li><a href="#ngrx-feature-states" class="table-of-contents__link">NgRx Feature states</a></li><li><a href="#preparing-for-feature-states" class="table-of-contents__link">Preparing for feature states</a></li><li><a href="#lazy-loading-feature-states" class="table-of-contents__link">Lazy loading feature states</a></li><li><a href="#where-to-be-careful" class="table-of-contents__link">Where to be careful</a></li><li><a href="#homework" class="table-of-contents__link">Homework</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Open Learning</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ngrx-essentials-course/docs/chapter-1">NgRx Essentials</a></li><li class="footer__item"><a href="https://this-is-learning.github.io/rxjs-fundamentals-course" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RxJS Fundamentals<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://dev.to/this-is-learning" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Learning on DEV Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://dev.to/this-is-angular" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Angular on DEV Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/ygKzbrBtVn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Learning Community on Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/this-is-learning" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Learning on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/this-is-learning" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Angular on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/this-is-angular/ngrx-essentials-course" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Star on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Thisis_Learning" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Learning on Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Thisis_Angular" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>This is Angular on Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2022 This is Learning. Licensed under CC BY-SA 4.0.</div></div></div></footer></div>
<script src="/ngrx-essentials-course/assets/js/runtime~main.1ab2ca4b.js"></script>
<script src="/ngrx-essentials-course/assets/js/main.7eecb326.js"></script>
</body>
</html>