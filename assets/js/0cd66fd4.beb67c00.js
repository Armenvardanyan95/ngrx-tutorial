"use strict";(self.webpackChunkngrx_course=self.webpackChunkngrx_course||[]).push([[586],{1833:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return c}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=n(6213),s=["components"],l={title:"Chapter 8: Modifying State",sidebar_position:8},p=void 0,d={unversionedId:"chapter-8",id:"chapter-8",isDocsHomePage:!1,title:"Chapter 8: Modifying State",description:"Adding stuff",source:"@site/docs/chapter-8.mdx",sourceDirName:".",slug:"/chapter-8",permalink:"/ngrx-essentials-course/docs/chapter-8",editUrl:"https://github.com/this-is-angular/ngrx-essentials-course/edit/main/docs/chapter-8.mdx",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Chapter 8: Modifying State",sidebar_position:8},sidebar:"courseSidebar",previous:{title:"Chapter 7: Basic Selectors",permalink:"/ngrx-essentials-course/docs/chapter-7"},next:{title:"Chapter 9: Building a real application",permalink:"/ngrx-essentials-course/docs/chapter-9"}},c=[{value:"Adding stuff",id:"adding-stuff",children:[]},{value:"Before we proceed",id:"before-we-proceed",children:[]},{value:"Homework",id:"homework",children:[]}],m={toc:c};function g(e){var t=e.components,l=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"adding-stuff"},"Adding stuff"),(0,r.kt)("p",null,"So far, we created a ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),", put some initial ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," in it, and displayed it in our component UI using ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors"),". One part that is missing is that we haven't done much using our ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," besides registering it in ",(0,r.kt)("inlineCode",{parentName:"p"},"AppModule"),". Now it is time to add some categories from our UI. As mentioned previously, to trigger the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," function, we need to dispatch an ",(0,r.kt)("inlineCode",{parentName:"p"},"Action")," on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),", and then the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"Action")," handler will be called, modify the ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," and propagate the changes all the way up to our UI."),(0,r.kt)("h2",{id:"before-we-proceed"},"Before we proceed"),(0,r.kt)("p",null,"First of all, let's build a small UI that wil allow users to add categories. In the ",(0,r.kt)("inlineCode",{parentName:"p"},"category-list")," template we are going to add an input in which the user can enter a name of the new category, and a button next to it that, when clicked, will add the category. We are using Angular Material, so let's build that UI. Let's add the ",(0,r.kt)("inlineCode",{parentName:"p"},"MatInputModule")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"MatButtonModule")," in our AppModule first, and also the ",(0,r.kt)("inlineCode",{parentName:"p"},"FormsModule")," to be able to read data from the inputs:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/app.module.ts\n\n// other imports omitted for brevity\nimport { MatInputModule } from "@angular/material/input";\nimport { MatButtonModule } from "@angular/material/button";\nimport { FormsModule } from "@angular/forms";\n\n@NgModule({\n  // other metadata\n  imports: [\n    // other imports\n    MatInputModule,\n    MatButtonModule,\n    FormsModule,\n  ],\n})\nexport class AppModule {}\n')),(0,r.kt)("p",null,"Now we can use the nice and shiny Material Input and the Button in our UI. Let's add those to our ",(0,r.kt)("inlineCode",{parentName:"p"},"category-list-presenter")," component template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<--\nsrc/app/category-list/category-list-presenter/category-list-presenter.component.html\n--\x3e\n<mat-list>\n  <mat-list-item *ngFor="let category of categories"\n    >{{ category.name }}</mat-list-item\n  >\n</mat-list>\n<mat-form-field>\n  <mat-label>New Category Name:</mat-label>\n  <input matInput [(ngModel)]="newCategoryName" />\n  <button mat-button (click)="addCategory()">Add Category</button>\n</mat-form-field>\n')),(0,r.kt)("p",null,"As you see, we have added an input, bind it to a class property named ",(0,r.kt)("inlineCode",{parentName:"p"},"newCategoryName"),", and will call a class method named ",(0,r.kt)("inlineCode",{parentName:"p"},"addCategory")," when the button is clicked."),(0,r.kt)("p",null,"As you remember, our presenter component does not add or modify the data on itself, is just receives the data and emits events. So when the button is clicked, we will emit a custom event that notifies the container component to add the category. Let's change our presenter component class code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/category-list/category-list-presenter/category-list-presenter.component.ts\nimport { Component, Input, Output, EventEmitter } from "@angular/core";\nimport { Category } from "src/app/state/models";\n\n@Component({\n  selector: "app-category-list-presenter",\n  templateUrl: "./category-list-presenter.component.html",\n  styleUrls: ["./category-list-presenter.component.scss"],\n})\nexport class CategoryListPresenterComponent {\n  @Input() categories: Category[] = [];\n  @Output() categoryAdded = new EventEmitter<Category>();\n  newCategoryName = "";\n\n  addCategory() {\n    this.categoryAdded.emit({ name: this.newCategoryName });\n  }\n}\n')),(0,r.kt)("p",null,"Pretty simple. Now, let's change the container component so that it listens to this event, and dispatches a corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"Action")," to update the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/category-list/category-list-container/category-list-container.component.ts\nimport { Component, OnInit } from "@angular/core";\nimport { Store } from "@ngrx/store";\n\nimport { addCategory } from "src/app/state/actions";\nimport { Category } from "src/app/state/models";\nimport { categories } from "src/app/state/selectors";\n\n@Component({\n  selector: "app-category-list-container",\n  template: `<app-category-list-presenter\n    [categories]="categories$ | async"\n    (categoryAdded)="addCategory($event)"\n  ></app-category-list-presenter>`,\n  styleUrls: ["./category-list-container.component.scss"],\n})\nexport class CategoryListContainerComponent implements OnInit {\n  categories$ = this.store.select(categories);\n\n  constructor(private readonly store: Store) {}\n\n  ngOnInit() {}\n\n  addCategory(category: Category) {\n    this.store.dispatch(addCategory({ payload: category })); // this is where the magic happens\n  }\n}\n')),(0,r.kt)("p",null,"There are two notable changes, first is the ",(0,r.kt)("inlineCode",{parentName:"p"},"addCategory")," method that listens to the ",(0,r.kt)("inlineCode",{parentName:"p"},"categoryAdded")," custom event from the presenter component, second is this line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"this.store.dispatch(addCategory({ payload: category }));\n")),(0,r.kt)("p",null,"As promised, magic happens here. We already covered that in order to trigger a ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," change, we need to ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Action"),", and that is precisely what we have done, using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),"'s ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," method. It passes the ",(0,r.kt)("inlineCode",{parentName:"p"},"Action")," (together with the payload) to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," function, the corresponding handler is being called and generates a new ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", then it propagates that change though the ",(0,r.kt)("inlineCode",{parentName:"p"},"Observables")," we used with ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors"),", and shows the result in the UI. We have already written the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," code, so go on and try our new feature out there in the UI."),(0,r.kt)("p",null,"Awesome, right?"),(0,r.kt)("p",null,"This diagram illustrates how the whole thing works:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"NgRx flow diagram",src:n(2285).Z})),(0,r.kt)("p",null,"This showcases the whole process we described:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Component dispatches an ",(0,r.kt)("inlineCode",{parentName:"li"},"Action")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"Reducer")," takes the old ",(0,r.kt)("inlineCode",{parentName:"li"},"State")," from the ",(0,r.kt)("inlineCode",{parentName:"li"},"Store")," and the ",(0,r.kt)("inlineCode",{parentName:"li"},"Action")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"Reducer")," creates the new ",(0,r.kt)("inlineCode",{parentName:"li"},"State")," and puts in the ",(0,r.kt)("inlineCode",{parentName:"li"},"Store")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"Store")," triggers the ",(0,r.kt)("inlineCode",{parentName:"li"},"Selectors")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"Selector")," emits the new derived ",(0,r.kt)("inlineCode",{parentName:"li"},"State")," to the component via an ",(0,r.kt)("inlineCode",{parentName:"li"},"Observable")),(0,r.kt)("li",{parentName:"ol"},"Component displays the new data with the ",(0,r.kt)("inlineCode",{parentName:"li"},"async")," pipe")),(0,r.kt)("p",null,"And that's it"),(0,r.kt)("h2",{id:"homework"},"Homework"),(0,r.kt)("p",null,"We created a flow in which the user can add a category. Now it is time for you to add a low in which the user can delete one. We already have the ",(0,r.kt)("inlineCode",{parentName:"p"},"Action")," responsible for this and the handler in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer"),", so go on and"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Add a delete button in front of every category item in the UI, which will emit a new ",(0,r.kt)("inlineCode",{parentName:"li"},"categoryDeleted")," event to the container"),(0,r.kt)("li",{parentName:"ol"},"In the container, dispatch the ",(0,r.kt)("inlineCode",{parentName:"li"},"Action")," that deletes the category and observe the results")),(0,r.kt)("p",null,"We have come full circle now and can read, modify and select ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". In the upcoming chapter, we will lay some groundwork so we can start interacting with remote APIs using NgRx."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Exercise 1 solution"),(0,r.kt)(i.Z,{title:"category-list-presenter.component.ts",className:"language-ts",mdxType:"CodeBlock"},'export class CategoryListPresenterComponent {\n  @Input() categories: Category[] = [];\n  @Output() categoryAdded = new EventEmitter<Category>();\n  @Output() categoryDeleted = new EventEmitter<string>();\n  newCategoryName = "";\n\n  addCategory() {\n    this.categoryAdded.emit({ name: this.newCategoryName });\n  }\n\n  deleteCategory(categoryName: string) {\n    this.categoryDeleted.emit(categoryName); // emitting a delete event\n  }\n}\n'),(0,r.kt)(i.Z,{title:"category-list-presenter.component.html",className:"language-ts",mdxType:"CodeBlock"},'<mat-list>\n  <mat-list-item *ngFor="let category of categories">\n    {{ category.name }}\n    <button mat-button (click)="deleteCategory(category.name)">Delete</button>\n  </mat-list-item>\n</mat-list>\n<mat-form-field>\n  <mat-label>New Category Name:</mat-label>\n  <input matInput [(ngModel)]="newCategoryName" />\n  <button mat-button (click)="addCategory()">Add Category</button>\n</mat-form-field>\n')),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Exercise 2 solution"),(0,r.kt)(i.Z,{title:"category-list-container.component.ts",className:"language-ts",mdxType:"CodeBlock"},'@Component({\n  selector: "app-category-list-container",\n  template: `<app-category-list-presenter\n    [categories]="categories$ | async"\n    (categoryAdded)="addCategory($event)"\n    (categoryDeleted)="deleteCategory($event)"\n  >\n  </app-category-list-presenter>`,\n  styleUrls: ["./category-list-container.component.scss"],\n})\nexport class CategoryListContainerComponent implements OnInit {\n  categories$ = this.store.select(categories);\n\n  constructor(private readonly store: Store) {}\n\n  ngOnInit() {}\n\n  addCategory(category: Category) {\n    this.store.dispatch(addCategory({ payload: category })); // this is where magic happens\n  }\n\n  deleteCategory(categoryName: string) {\n    this.store.dispatch(deleteCategory({ payload: categoryName }));\n  }\n}\n')))}g.isMDXComponent=!0},2285:function(e,t,n){t.Z=n.p+"assets/images/store-diagram-660a748ec669ca78a3ffb3a509722b72.png"}}]);