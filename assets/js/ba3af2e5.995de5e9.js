"use strict";(self.webpackChunkngrx_course=self.webpackChunkngrx_course||[]).push([[998],{5827:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return p},default:function(){return u},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=n(6213),s=["components"],l={title:"Chapter 7: Basic Selectors",sidebar_position:7},p=void 0,c={unversionedId:"chapter-7",id:"chapter-7",isDocsHomePage:!1,title:"Chapter 7: Basic Selectors",description:"Using data from Store in components",source:"@site/docs/chapter-7.mdx",sourceDirName:".",slug:"/chapter-7",permalink:"/ngrx-essentials-course/docs/chapter-7",editUrl:"https://github.com/this-is-angular/ngrx-essentials-course/edit/main/docs/chapter-7.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Chapter 7: Basic Selectors",sidebar_position:7},sidebar:"courseSidebar",previous:{title:"Chapter 6: Reducers",permalink:"/ngrx-essentials-course/docs/chapter-6"},next:{title:"Chapter 8: Modifying State",permalink:"/ngrx-essentials-course/docs/chapter-8"}},d=[{value:"Using data from Store in components",id:"using-data-from-store-in-components",children:[]},{value:"What are Selectors?",id:"what-are-selectors",children:[]},{value:"Building some UI",id:"building-some-ui",children:[]},{value:"Writing Selectors",id:"writing-selectors",children:[]}],m={toc:d};function u(e){var t=e.components,n=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"using-data-from-store-in-components"},"Using data from Store in components"),(0,r.kt)("p",null,"So far, we have created ",(0,r.kt)("inlineCode",{parentName:"p"},"Actions")," that will notify about ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," changes and a ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," function that does the actual ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," modifications. But we have not used the ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," of our application to display any visual UI corresponding to that ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". It is high time we do that. To do that, NgRx uses a concept called ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors"),". Let's understand the basics of that."),(0,r.kt)("h2",{id:"what-are-selectors"},"What are Selectors?"),(0,r.kt)("p",null,"In most simple terms, ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," are ",(0,r.kt)("inlineCode",{parentName:"p"},"pure functions")," that take the ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," of ur application, and return a piece of it so that it can be used in a component (you will see NgRx extensively uses ",(0,r.kt)("inlineCode",{parentName:"p"},"pure functions"),"). In more detail, in the future chapters, our ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," will evolve to contain lots of data in the main object, for example, we will have categories, expenses, incomes, probably data about the current user (authentication, full name, etc) and so on. Obviously in a single component we don't need the entire ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", thus we write ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," which will return pieces of that ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", for example, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Selector")," that return only the array of categories to use in the corresponding component."),(0,r.kt)("p",null,'Those pieces are called "slices" of the ',(0,r.kt)("inlineCode",{parentName:"p"},"State")," sometimes, but often the term ",(0,r.kt)("inlineCode",{parentName:"p"},"derived State")," is used, to indicate it is some modified form of the original ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," can also be used to return not just a slice, but some complex calculation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", for example, we can write a ",(0,r.kt)("inlineCode",{parentName:"p"},"Selector")," that calculates the total income based on all the items in the ",(0,r.kt)("inlineCode",{parentName:"p"},"incomes")," array, and based on that ",(0,r.kt)("inlineCode",{parentName:"p"},"Selector"),", another one that calculates the average."),(0,r.kt)("p",null,'This chapter is called "Basic Selectors", so in this one we are going to write only such ',(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," that return just slices of the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),"; in the future chapters, we will write more complex ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," and learn how to create new ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," from existing ones, and also how to combine them into new ones."),(0,r.kt)("h2",{id:"building-some-ui"},"Building some UI"),(0,r.kt)("p",null,"Before we proceed, let's first build some UI to show the list of the Categories. In this project, I am using Angular Material to build some pretty interface, but you can use any UI library of your choice (or even not use any). But I suggest you do use Angular Material (we are not going to use too complex components from there, even if you are unfamiliar with it, it won;t be too challenging) to follow the examples easier. You can also visit the ",(0,r.kt)("a",{parentName:"p",href:"https://material.angular.io/"},"Angular Material official documentation")," to grasp some new knowledge. If you choose to use it, follow this chapter; if not, skip to the next one."),(0,r.kt)("p",null,"Let's add Angular Material to our project first. Run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ng add @angular/material\n")),(0,r.kt)("p",null,"It might ask some multiple choice questions. You may choose a theme, whichever you prefer."),(0,r.kt)("p",null,"Angular Material has been added to our project. Now, let's add a component that will display the list of categories of expenses/incomes from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),". I will be using the Container-Presenter approach to build this component. It means we will create two components, one that handles the logic (selects data from the store, in our case), and passes it two the next one, and the other one, which only receives the data as ",(0,r.kt)("inlineCode",{parentName:"p"},"@Input")," properties and displays the UI. You can read mor e about Container-Presenter ",(0,r.kt)("a",{parentName:"p",href:"https://blog.angular-university.io/angular-component-design-how-to-avoid-custom-event-bubbling-and-extraneous-properties-in-the-local-component-tree/"},"here"),"."),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"src/app")," folder, create a new folder named ",(0,r.kt)("inlineCode",{parentName:"p"},"category-list"),". Inside that folder, run the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ng generate component CategoryListContainer\nng generate component CategoryListPresenter\n")),(0,r.kt)("p",null,"Now we have two components. Let's start with the presenter, because it is the simple one. Basically, we just need to receive the array of categories as an ",(0,r.kt)("inlineCode",{parentName:"p"},"@Input")," property, and display the categories using ",(0,r.kt)("inlineCode",{parentName:"p"},"*ngFor"),". Let's write that code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/category-list/category-list-presenter/category-list-presenter.component.ts\nimport { Component, Input, ChangeDetection } from "@angular/core";\n\n// import the Category interface from wherever you put it\n\n@Component({\n  selector: "app-category-list-presenter",\n  templateUrl: "./category-list-presenter.component.html",\n  changeDetectionStrategy: ChangeDetection.OnPush, // we can use OnPush as we only rely on Input properties for data\n})\nexport class CategoryListPresenter {\n  @Input() categories: Category[] = [];\n}\n')),(0,r.kt)("p",null,"The component class code is ready - simple as that. Now, to display the list of categories, let's import some components from Angular Material into our ",(0,r.kt)("inlineCode",{parentName:"p"},"AppModule"),". We will be using the ",(0,r.kt)("inlineCode",{parentName:"p"},"<mat-list>")," component to display a very basic list of our categories:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/app.module.ts\n// other import statements omitted for the sake of brevity\nimport { MatListModule } from "@angular/material";\n\n@NgModule({\n  // other metadata omitted\n  imports: [\n    // other imports omitted\n    MatListModule,\n  ],\n  declarations: [AppComponent, CategoryListContainer, CategoryListPresenter],\n})\nexport class AppModule {}\n')),(0,r.kt)("p",null,"We are all set to write the template for the presenter component:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<--\nsrc/app/category-list/category-list-presenter/category-list-presenter.component.html\n--\x3e\n<mat-list>\n  <mat-list-item *ngFor="let category of categories"\n    >{{ category.name }}</mat-list-item\n  >\n  <.mat-list></mat-list\n>\n')),(0,r.kt)("p",null,"Now the only thing left is to select the data from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store")," in the container component, and pass it as ",(0,r.kt)("inlineCode",{parentName:"p"},"@Input")," to the presenter. To select the data, we need to inject the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store")," into our component. The ",(0,r.kt)("inlineCode",{parentName:"p"},"Store")," is a special service-class from NgRx that allows us to interact with the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". To inject that store, we need to import the ",(0,r.kt)("inlineCode",{parentName:"p"},"StoreModule")," into our ",(0,r.kt)("inlineCode",{parentName:"p"},"AppModule"),", and provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducer")," from our previous chapter, so that NgRx knows what is our data an how it is modified. Let;s do this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/app.module.ts\n// other import statements omitted for the sake of brevity\nimport { StoreModule } from "@ngrx/store";\nimport { reducer } from "./state/reducer";\n\n@NgModule({\n  // other metadata omitted\n  imports: [\n    // other imports omitted\n    StoreModule.forRoot({ categories: reducer }),\n  ],\n})\nexport class AppModule {}\n')),(0,r.kt)("p",null,"A question arises, why did we provide an object with the ",(0,r.kt)("inlineCode",{parentName:"p"},"reducer")," function, and not just the ",(0,r.kt)("inlineCode",{parentName:"p"},"reducer"),"? That is because we can have multiple ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducers")," (and we will in the future chapters), and we can also lazy-load ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," (we will learn about it in the later chapters too), so we need to provide a mapping of features to reducers. In our case, we only have one feature, that is the categories ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", so this is th object. In the future, when we add more feature ",(0,r.kt)("inlineCode",{parentName:"p"},"States"),", we will rename the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reducers")," to more accurately reflect the situation. For now, our global state looks like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"{categories: AppState}"),".\nNow it is time to write the ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors"),"."),(0,r.kt)("h2",{id:"writing-selectors"},"Writing Selectors"),(0,r.kt)("p",null,"Selectors are functions, as you remember from a past paragraph. We usually put them in separate files. In the ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," folder, create a new file named ",(0,r.kt)("inlineCode",{parentName:"p"},"selectors.ts"),", and let's write our first selector, that return the list of the categories:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/state/selectors.ts\nimport { AppState } from "./state";\n\nexport const categories = (state: { categories: AppState }) =>\n  state.categories.categories;\n')),(0,r.kt)("p",null,"Our state contains a property named ",(0,r.kt)("inlineCode",{parentName:"p"},"categories")," that is the ",(0,r.kt)("inlineCode",{parentName:"p"},"categories")," ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", which for now is named ",(0,r.kt)("inlineCode",{parentName:"p"},"AppState"),", as it is all that we have in out app. That's why we have to return ",(0,r.kt)("inlineCode",{parentName:"p"},"state.categories.categories"),"."),(0,r.kt)("p",null,"And that's it. As promised, the selector is as basic as it can get, it takes the ",(0,r.kt)("inlineCode",{parentName:"p"},"AppState"),", which, as you remember, looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export interface AppState {\n  categories: Category[];\n}\n")),(0,r.kt)("p",null,"and returns that ",(0,r.kt)("inlineCode",{parentName:"p"},"categories")," array."),(0,r.kt)("p",null,"Now let's use it in the container component. As mentioned, we inject the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store")," and select the state slice using our brand new selector. Here is how it will look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/category-list/category-list-container/category-list-container.component.ts\nimport { Component } from "@angular/core";\nimport { Store } from "@ngrx/store";\n\nimport { categories } from "../../state/selectors";\n\n@Component({\n  selector: "app-category-list-presenter",\n  template:\n    \'<app-category-list-presenter [categories]="categories$ | async"></app-category-list-presenter>\',\n})\nexport class CategoryListContainer {\n  categories$ = this.store.select(categories);\n\n  constructor(private readonly store: Store) {}\n}\n')),(0,r.kt)("p",null,"And that's it. Let's understand what happened here. First, we imported and injected the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),", as promised. Then, we used the ",(0,r.kt)("inlineCode",{parentName:"p"},"store")," instance to get the data that we wanted. The ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," method takes a ",(0,r.kt)("inlineCode",{parentName:"p"},"selector")," and returns an ",(0,r.kt)("inlineCode",{parentName:"p"},"Observable")," of the slice of the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", in out case, the ",(0,r.kt)("inlineCode",{parentName:"p"},"categories")," array. It is important that it returns an ",(0,r.kt)("inlineCode",{parentName:"p"},"Observable")," of that slice, rather than the data itself, this way whenever any part of our application updates the state (for example, by adding a new ",(0,r.kt)("inlineCode",{parentName:"p"},"Category")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store"),"), we will be instantly notified about it, thus making NgRx magic happen. Then we just pass that unwrapped data to the child component using the ",(0,r.kt)("inlineCode",{parentName:"p"},"async")," pipe"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": we wil be using the ",(0,r.kt)("inlineCode",{parentName:"p"},"async")," pipe extensively, as NgRx works only with ",(0,r.kt)("inlineCode",{parentName:"p"},"Observables"),".")),(0,r.kt)("p",null,"Now let's create some routing. Let's create a routing module and a route that takes us to the category list page. Create an ",(0,r.kt)("inlineCode",{parentName:"p"},"app.routing.module.ts")," file and put the following code in it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/app.routing.module.ts\n\nimport { NgModule } from "@angular/core";\nimport { RouterModule, Routes } from "@angular/router";\n\nimport { CategoryListContainerComponent } from "./category-list/category-list-container/category-list-container";\n\nconst routes = [\n  { path: "categories", component: CategoryListContainerComponent },\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Don't forget to add the ",(0,r.kt)("inlineCode",{parentName:"p"},"AppRoutingModule")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"imports")," array in ",(0,r.kt)("inlineCode",{parentName:"p"},"AppModule")," and put a ",(0,r.kt)("inlineCode",{parentName:"p"},"<router-outlet>")," in your ",(0,r.kt)("inlineCode",{parentName:"p"},"AppComponent")," template!")),(0,r.kt)("p",null,"Now open your app and navigate to ",(0,r.kt)("inlineCode",{parentName:"p"},"/categories"),". Aaaand... nothing. You won't see anything. That is because we don't have any categories in our ",(0,r.kt)("inlineCode",{parentName:"p"},"initialState"),"! It was an empty array, remember? Let's change it a bit, so that it contains the most basic expense everyone makes: Food:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// src/app/state/state.ts\n\n// rest of the file omitted for the sake of brevity\n\nconst initialState: AppState = {\n  categories: [{ name: "Food" }],\n};\n')),(0,r.kt)("p",null,"Now you will see the list of the categories when you open the app (basically just Food, but that's enough for now). NgRx magic works!"),(0,r.kt)("p",null,"This chapter has been long, and we set up lots of stuff for future development, and also we have a very basic ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," at this point, so there won't be any homework to write new ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors"),". Instead, let's Create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," interface that contains the list of categories, and in ",(0,r.kt)("inlineCode",{parentName:"p"},"AppState")," include it under the name ",(0,r.kt)("inlineCode",{parentName:"p"},"categories"),", and rename the ",(0,r.kt)("inlineCode",{parentName:"p"},"reducer")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"categoryReducer"),". Then, rename the ",(0,r.kt)("inlineCode",{parentName:"p"},"categories")," array to ",(0,r.kt)("inlineCode",{parentName:"p"},"list"),". Our selector will then look like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"const categories = (state: AppState) => state.categories.list"),"."),(0,r.kt)("p",null,"We will be writing new ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," a lot in the future though, so be prepared."),(0,r.kt)("p",null,"We learned how to create ",(0,r.kt)("inlineCode",{parentName:"p"},"Selectors")," and use them to display data from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Store")," in our UI. Next, we will learn how to trigger ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," changes and see the actual benefit of NgRx."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Exercise solution"),(0,r.kt)(i.Z,{title:"state.ts",className:"language-ts",mdxType:"CodeBlock"},"export interface CategoryState {\n  list: Category[];\n}\n\nexport interface AppState {\n  categories: CategoryState;\n}\n"),(0,r.kt)(i.Z,{title:"app.module.ts",className:"language-ts",mdxType:"CodeBlock"},"@NgModule({\n  // other metadata\n  imports: [\n    // other imports\n    StoreModule.forRoot({ categories: categoriesReducer }),\n  ],\n})\nexport class AppModule {}\n"),(0,r.kt)(i.Z,{title:"selectors.ts",className:"language-ts",mdxType:"CodeBlock"},"const categories = (state: AppState) => state.categories.list;\n")))}u.isMDXComponent=!0}}]);